<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Generating GDL</title>

  <script src="../../blockly_uncompressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../generators/gdl.js"></script>
  <script src="../../generators/gdl/gdl_SimpleBodies.js"></script>
  <script src="../../generators/gdl/gdl_Transform.js"></script>
  <script src="../../generators/gdl/gdl_Attributes.js"></script>
  <script src="../../generators/gdl/gdl_Texts.js"></script>
  <script src="../../generators/gdl/gdl_ComplexBodies.js"></script>
  <script src="../../generators/gdl/gdl_Controls.js"></script>
  <script src="../../generators/gdl/gdl_Variables.js"></script>
  <script src="../../generators/gdl/gdl_Math.js"></script>
  <script src="../../msg/js/en.js"></script>
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
    .commentStyle {
      font-style: italic;
    }
  </style>
</head>

<body>
  <p>
    <button onclick="showCode()">Show GDL</button>
    <button onclick="showXML()">Show XML</button>
  </p>

  <div id="blocklyDiv" style="height: 480px; width: 980px;"></div>
  <form>
    <input id="xmlInput" type="text" style="height: 480px; width: 980px;">
    </input>
  </form>

  <xml id="toolbox" style="display: none">

    <!-- GDL generators -->
    <category name="Simple Bodies" colour="#e056fd">
      <block type="gdl_3d_block"></block>
      <block type="gdl_3d_sphere"></block>
      <block type="gdl_3d_cylind"></block>
      <block type="gdl_3d_ellipse"></block>
      <block type="gdl_3d_cone"></block>
    </category>
    
    <!-- Simple transformations-->
    <category name="Transform" colour="#6ab04c">
      <block type="gdl_3d_addx"></block>
      <block type="gdl_3d_addy"></block>
      <block type="gdl_3d_addz"></block>
      <block type="gdl_3d_rotx"></block>
      <block type="gdl_3d_roty"></block>
      <block type="gdl_3d_rotz"></block>
      <block type="gdl_3d_mulx"></block>
      <block type="gdl_3d_muly"></block>
      <block type="gdl_3d_mulz"></block>
    </category>

    <!-- GDL Attributes-->
    <category name="Attributes" colour="#b26942">
      <block type="gdl_pen"></block>
      <block type="gdl_material"></block>
      <block type="gdl_resol"></block>
    </category>

    <!-- GDL control structures -->
    <category name="Controls" colour="#f0932b">
      <block type="gdl_controls_if_el_end"></block>
      <block type="gdl_controls_if_end"></block>
      <block type="gdl_controls_for"></block>
    </category>

    <!-- GDL expressions -->
    <category name="Math" colour="#686de0">
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
      <block type="gdl_math_compare"></block>
      <block type="gdl_math_operator"></block>
      <block type="gdl_math_abs"></block>
      <block type="gdl_math_sqr"></block>
      <block type="gdl_math_sin"></block>
      <block type="gdl_math_cos"></block>
      <block type="gdl_math_tan"></block>
    </category>

    <!-- GDL Variables -->
    <category name="Variables" colour="#eb4d4b">
      <block type="gdl_set_variable"></block>
      <block type="gdl_get_variable"></block>      
    </category>

    <!-- GDL Complex 3D models -->
    <category name="Complex Bodies" colour="#22a6b3">
      <block type="gdl_3d_prism"></block>
      <block type="gdl_3d_prism_"></block>
      <block type="gdl_3d_revolve"></block>
      <block type="gdl_xy_list"></block>
      <block type="gdl_xys_list"></block>
      <block type="gdl_2d_coordinate"></block>
      <block type="gdl_2d_coordinate_status"></block>
    </category>

    <!-- GDL Texts and Comments-->
    <category name="Texts" colour="#95afc0">
      <block type="gdl_text"></block>
      <block type="gdl_single_comment"></block>
    </category>
  </xml>

  <xml id="startBlocks" style="display:none">
    <variables>
      <variable type="" id="q|_-0fLxoVPPqpe^SErr">row</variable>
      <variable type="" id="-K|MPT`dh{^nK;1C%j{*">sumSeats</variable>
      <variable type="" id="Xoj/HzC)n(Ai.!01Ni.+">seat</variable>
    </variables>
    <block type="gdl_material" id="vmtGdU}c[S4;K!{26-p`" x="10" y="10">
      <value name="M">
        <block type="math_number" id="3ajs[olcdLjLE{7%_ijY">
          <field name="NUM">11</field>
        </block>
      </value>
      <next>
        <block type="gdl_resol" id="$)#+c8i=jml82%/,:Y#i">
          <value name="R">
            <block type="math_number" id="24j|[:+qYrn0+NW$((m=">
              <field name="NUM">8</field>
            </block>
          </value>
          <next>
            <block type="gdl_controls_for" id="ZD]3:}EtQ9+Dd.us^plU">
              <field name="VAR" id="q|_-0fLxoVPPqpe^SErr" variabletype="">row</field>
              <value name="FROM">
                <block type="math_number" id="mhDXZu7Si8Zg`sdU+~YZ">
                  <field name="NUM">1</field>
                </block>
              </value>
              <value name="TO">
                <block type="math_number" id="05p}a%_Z:Rx@|o?cfC9u">
                  <field name="NUM">10</field>
                </block>
              </value>
              <statement name="DO0">
                <block type="gdl_set_variable" id="Tpbf]S8sH3z)=1er2Fl/">
                  <field name="VAR" id="-K|MPT`dh{^nK;1C%j{*" variabletype="">sumSeats</field>
                  <value name="VALUE">
                    <block type="math_arithmetic" id="Y}VIe~-C]EJoW_o/,6Le">
                      <field name="OP">ADD</field>
                      <value name="A">
                        <block type="math_arithmetic" id="m.2${p`?q0ZMDy#X2-%X">
                          <field name="OP">MULTIPLY</field>
                          <value name="A">
                            <block type="gdl_get_variable" id="2^3~Kno4fioyu?V0[f=U">
                              <field name="VAR" id="q|_-0fLxoVPPqpe^SErr" variabletype="">row</field>
                            </block>
                          </value>
                          <value name="B">
                            <block type="math_number" id="Nv5$cQnwkEro];pTQ~zj">
                              <field name="NUM">4</field>
                            </block>
                          </value>
                        </block>
                      </value>
                      <value name="B">
                        <block type="math_number" id="EDGM2;40UPd?z^BGyR#n">
                          <field name="NUM">12</field>
                        </block>
                      </value>
                    </block>
                  </value>
                  <next>
                    <block type="gdl_3d_addz" id="0cG60+8@Z$1.E2QTx!)_">
                      <value name="Z">
                        <block type="math_arithmetic" id="g@BPV|v4(274pxAS_#`^">
                          <field name="OP">MULTIPLY</field>
                          <value name="A">
                            <block type="gdl_get_variable" id="1#n66Z%~}w9-3mQ,h78w">
                              <field name="VAR" id="q|_-0fLxoVPPqpe^SErr" variabletype="">row</field>
                            </block>
                          </value>
                          <value name="B">
                            <block type="math_number" id=":`J0u^SrqJGz3RbS-Vyl">
                              <field name="NUM">0.5</field>
                            </block>
                          </value>
                        </block>
                      </value>
                      <statement name="DO0">
                        <block type="gdl_controls_for" id="/p#Fw?,A/DMzN]j3I$M}">
                          <field name="VAR" id="Xoj/HzC)n(Ai.!01Ni.+" variabletype="">seat</field>
                          <value name="FROM">
                            <block type="math_number" id="d@9mySVg8APBQ8@c]y36">
                              <field name="NUM">1</field>
                            </block>
                          </value>
                          <value name="TO">
                            <block type="gdl_get_variable" id="0A2?LBLe7FkhK!#]7_[.">
                              <field name="VAR" id="-K|MPT`dh{^nK;1C%j{*" variabletype="">sumSeats</field>
                            </block>
                          </value>
                          <statement name="DO0">
                            <block type="gdl_3d_rotz" id="@82QgV-hjJ{B+LIa[ls(">
                              <value name="Z">
                                <block type="math_arithmetic" id="$$eDSq!X`#C6F!Nr(oJU">
                                  <field name="OP">MULTIPLY</field>
                                  <value name="A">
                                    <block type="math_arithmetic" id="?c@XMn/1haM]1xoy33!Z">
                                      <field name="OP">DIVIDE</field>
                                      <value name="A">
                                        <block type="math_number" id="!$a!(Mg+xX3+R%@guD[F">
                                          <field name="NUM">360</field>
                                        </block>
                                      </value>
                                      <value name="B">
                                        <block type="gdl_get_variable" id="rjCT{$(?QjjMx@*cER3M">
                                          <field name="VAR" id="-K|MPT`dh{^nK;1C%j{*" variabletype="">sumSeats</field>
                                        </block>
                                      </value>
                                    </block>
                                  </value>
                                  <value name="B">
                                    <block type="gdl_get_variable" id="`,VtQhdti8GhhsLA@KtX">
                                      <field name="VAR" id="Xoj/HzC)n(Ai.!01Ni.+" variabletype="">seat</field>
                                    </block>
                                  </value>
                                </block>
                              </value>
                              <statement name="DO0">
                                <block type="gdl_3d_addx" id="DlQ31kUf_7V4!84BkN9e">
                                  <value name="X">
                                    <block type="math_arithmetic" id="3crX(Nm@jy%2]d}.4=T(">
                                      <field name="OP">ADD</field>
                                      <value name="A">
                                        <block type="math_arithmetic" id="!IXXye=wmKSel_sr(X!J">
                                          <field name="OP">DIVIDE</field>
                                          <value name="A">
                                            <block type="gdl_get_variable" id="C15?knAvDzF~q$ljPHQ!">
                                              <field name="VAR" id="q|_-0fLxoVPPqpe^SErr" variabletype="">row</field>
                                            </block>
                                          </value>
                                          <value name="B">
                                            <block type="math_number" id="`UMoHDsAY^4r+g@2MyZW">
                                              <field name="NUM">2</field>
                                            </block>
                                          </value>
                                        </block>
                                      </value>
                                      <value name="B">
                                        <block type="math_number" id="]mtXei+uM}ta#s=$X@TT">
                                          <field name="NUM">2</field>
                                        </block>
                                      </value>
                                    </block>
                                  </value>
                                  <statement name="DO0">
                                    <block type="gdl_3d_cylind" id="DJVALIqLDqV.Zw0RSXg3">
                                      <value name="H">
                                        <block type="math_number" id="YCCh{#h*%0t5^93,C`^+">
                                          <field name="NUM">0.1</field>
                                        </block>
                                      </value>
                                      <value name="R">
                                        <block type="math_number" id="1_[j={7Wx==:1,vpz0iQ">
                                          <field name="NUM">0.3</field>
                                        </block>
                                      </value>
                                    </block>
                                  </statement>
                                </block>
                              </statement>
                            </block>
                          </statement>
                        </block>
                      </statement>
                    </block>
                  </next>
                </block>
              </statement>
            </block>
          </next>
        </block>
      </next>
    </block>
    </xml>
  <script>
    var demoWorkspace = Blockly.inject('blocklyDiv',
      { 
        toolbox: document.getElementById('toolbox'),
        horizontalLayout: 'true' 
      });
    Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'), demoWorkspace);

    function showCode() {
      // Generate JavaScript code and display it.
      Blockly.GDL.INFINITE_LOOP_TRAP = null;
      var code = Blockly.GDL.workspaceToCode(demoWorkspace);
      alert(code);
    }

    function showXML() {
      var xml = Blockly.Xml.workspaceToDom (demoWorkspace);
      document.getElementById ('xmlInput').value = xml.outerHTML;
    }
  </script>
</body>

</html>