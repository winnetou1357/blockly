<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Generating GDL</title>

  <script src="../../blockly_uncompressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../generators/gdl.js"></script>
  <script src="../../generators/gdl/gdl_SimpleBodies.js"></script>
  <script src="../../generators/gdl/gdl_Transform.js"></script>
  <script src="../../generators/gdl/gdl_Attributes.js"></script>
  <script src="../../generators/gdl/gdl_Texts.js"></script>
  <script src="../../generators/gdl/gdl_ComplexBodies.js"></script>
  <script src="../../generators/gdl/gdl_Controls.js"></script>
  <script src="../../generators/gdl/gdl_Variables.js"></script>
  <script src="../../generators/gdl/gdl_Math.js"></script>
  <script src="../../msg/js/en.js"></script>
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
</head>

<body>
  <p>
    <button onclick="showCode()">Show GDL</button>
    <button onclick="runCode()">Run GDL</button>
  </p>

  <div id="blocklyDiv" style="height: 480px; width: 980px;"></div>

  <xml id="toolbox" style="display: none">

    <!-- GDL generators -->
    <category name="Simple Bodies" colour="270">
      <block type="gdl_3d_block"></block>
      <block type="gdl_3d_sphere"></block>
      <block type="gdl_3d_cylind"></block>
      <block type="gdl_3d_ellipse"></block>
      <block type="gdl_3d_cone"></block>
    </category>
    
    <!-- Simple transformations-->
    <category name="Transform" colour="120">
      <block type="gdl_3d_addx"></block>
      <block type="gdl_3d_addy"></block>
      <block type="gdl_3d_addz"></block>
      <block type="gdl_3d_rotx"></block>
      <block type="gdl_3d_roty"></block>
      <block type="gdl_3d_rotz"></block>
      <block type="gdl_3d_mulx"></block>
      <block type="gdl_3d_muly"></block>
      <block type="gdl_3d_mulz"></block>
    </category>

    <!-- GDL Attributes-->
    <category name="Attributes" colour="325">
      <block type="gdl_pen"></block>
      <block type="gdl_material"></block>
    </category>

    <!-- GDL control structures -->
    <category name="Controls" colour="225">
      <block type="gdl_controls_if_el_end"></block>
      <block type="gdl_controls_if_end"></block>
      <block type="gdl_controls_for"></block>
    </category>

    <!-- GDL expressions -->
    <category name="Math" colour="190">
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
      <block type="gdl_math_compare"></block>
      <block type="gdl_math_operator"></block>
      <block type="gdl_math_abs"></block>
      <block type="gdl_math_sqr"></block>
      <block type="gdl_math_sin"></block>
      <block type="gdl_math_cos"></block>
      <block type="gdl_math_tan"></block>
    </category>

    <!-- GDL Variables -->
    <category name="Variables" colour="0">
      <block type="gdl_set_variable"></block>
      <block type="gdl_get_variable"></block>      
    </category>

    <!-- GDL Complex 3D models -->
    <category name="Complex bodies" colour="60">
      <block type="lists_create_with"></block>
      <block type="gdl_2d_coordinate"></block>
      <block type="gdl_3d_prism"></block>
    </category>

    <!-- GDL Texts and Comments-->
    <category name="Texts" colour="30">
        <block type="gdl_text"></block>
    </category>
  </xml>

  <xml id="startBlocks" style="display: none">
    <block type="gdl_3d_cone" inline="false">
      <value name="H">
        <block type="math_arithmetic">
          <value name="A">
            <block type="math_number">
              <field name="NUM">0</field>
            </block>
          </value>
          <value name="B">
            <block type="math_number">
              <field name="NUM">1</field>
            </block>
          </value>
        </block>
      </value>
      <value name="R_BOTTOM">
        <block type="math_number">
          <field name="NUM">2</field>
        </block>
      </value>
      <value name="R_TOP">
        <block type="math_number">
          <field name="NUM">2</field>
        </block>
      </value>
    </block>
  </xml>

  <script>
    var demoWorkspace = Blockly.inject('blocklyDiv',
      { 
        toolbox: document.getElementById('toolbox'),
        horizontalLayout: 'true' 
      });
    Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'), demoWorkspace);

    function showCode() {
      // Generate JavaScript code and display it.
      Blockly.GDL.INFINITE_LOOP_TRAP = null;
      var code = Blockly.GDL.workspaceToCode(demoWorkspace);
      alert(code);
    }

    function runCode() {
      // Generate JavaScript code and run it.
      window.LoopTrap = 1000;
      Blockly.GDL.INFINITE_LOOP_TRAP =
        'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
      var code = Blockly.GDL.workspaceToCode(demoWorkspace);
      Blockly.GDL.INFINITE_LOOP_TRAP = null;
      try {
        eval(code);
      } catch (e) {
        alert(e);
      }
    }
  </script>

</body>

</html>