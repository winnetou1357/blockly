<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Generating GDL</title>

  <script src="../../blockly_uncompressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../generators/gdl.js"></script>
  <script src="../../generators/gdl/gdl_SimpleBodies.js"></script>
  <script src="../../generators/gdl/gdl_Transform.js"></script>
  <script src="../../generators/gdl/gdl_Attributes.js"></script>
  <script src="../../generators/gdl/gdl_Texts.js"></script>
  <script src="../../generators/gdl/gdl_ComplexBodies.js"></script>
  <script src="../../generators/gdl/gdl_Controls.js"></script>
  <script src="../../generators/gdl/gdl_Variables.js"></script>
  <script src="../../generators/gdl/gdl_Math.js"></script>
  <script src="../../msg/js/en.js"></script>
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
    .commentStyle {
      font-style: italic;
    }
  </style>
</head>

<body>
  <p>
    <button onclick="showCode()">Show GDL</button>
    <button onclick="showXML()">Show XML</button>
    <button onclick="runCode()">Run GDL</button>
  </p>

  <div id="blocklyDiv" style="height: 480px; width: 980px;"></div>

  <xml id="toolbox" style="display: none">

    <!-- GDL generators -->
    <category name="Simple Bodies" colour="270">
      <block type="gdl_3d_block"></block>
      <block type="gdl_3d_sphere"></block>
      <block type="gdl_3d_cylind"></block>
      <block type="gdl_3d_ellipse"></block>
      <block type="gdl_3d_cone"></block>
    </category>
    
    <!-- Simple transformations-->
    <category name="Transform" colour="120">
      <block type="gdl_3d_addx"></block>
      <block type="gdl_3d_addy"></block>
      <block type="gdl_3d_addz"></block>
      <block type="gdl_3d_rotx"></block>
      <block type="gdl_3d_roty"></block>
      <block type="gdl_3d_rotz"></block>
      <block type="gdl_3d_mulx"></block>
      <block type="gdl_3d_muly"></block>
      <block type="gdl_3d_mulz"></block>
    </category>

    <!-- GDL Attributes-->
    <category name="Attributes" colour="325">
      <block type="gdl_pen"></block>
      <block type="gdl_material"></block>
      <block type="gdl_resol"></block>
    </category>

    <!-- GDL control structures -->
    <category name="Controls" colour="225">
      <block type="gdl_controls_if_el_end"></block>
      <block type="gdl_controls_if_end"></block>
      <block type="gdl_controls_for"></block>
    </category>

    <!-- GDL expressions -->
    <category name="Math" colour="190">
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
      <block type="gdl_math_compare"></block>
      <block type="gdl_math_operator"></block>
      <block type="gdl_math_abs"></block>
      <block type="gdl_math_sqr"></block>
      <block type="gdl_math_sin"></block>
      <block type="gdl_math_cos"></block>
      <block type="gdl_math_tan"></block>
    </category>

    <!-- GDL Variables -->
    <category name="Variables" colour="0">
      <block type="gdl_set_variable"></block>
      <block type="gdl_get_variable"></block>      
    </category>

    <!-- GDL Complex 3D models -->
    <category name="Complex Bodies" colour="60">
      <block type="gdl_3d_prism"></block>
      <block type="gdl_3d_prism_"></block>
      <block type="gdl_3d_revolve"></block>
      <block type="gdl_xy_list"></block>
      <block type="gdl_xys_list"></block>
      <block type="gdl_2d_coordinate"></block>
      <block type="gdl_2d_coordinate_status"></block>
    </category>

    <!-- GDL Texts and Comments-->
    <category name="Texts" colour="30">
      <block type="gdl_text"></block>
      <block type="gdl_single_comment"></block>
    </category>
  </xml>

  <xml id="startBlocks" style="display:none">
    <variables>
      <variable type="" id="Xoj/HzC)n(Ai.!01Ni.+">seat</variable>
    </variables>
    <block type="gdl_material" id="vmtGdU}c[S4;K!{26-p`" x="10" y="10">
      <value name="M">
        <block type="math_number" id="3ajs[olcdLjLE{7%_ijY">
          <field name="NUM">11</field>
        </block>
      </value>
      <next>
        <block type="gdl_resol" id="$)#+c8i=jml82%/,:Y#i">
          <value name="R">
            <block type="math_number" id="24j|[:+qYrn0+NW$((m=">
              <field name="NUM">8</field>
            </block>
          </value>
          <next>
            <block type="gdl_controls_for" id="/p#Fw?,A/DMzN]j3I$M}">
              <field name="VAR" id="Xoj/HzC)n(Ai.!01Ni.+" variabletype="">seat</field>
              <value name="FROM">
                <block type="math_number" id="d@9mySVg8APBQ8@c]y36">
                  <field name="NUM">1</field>
                </block>
              </value>
              <value name="TO">
                <block type="math_number" id="y0XA|gC*+.LP+b#p(rx{">
                  <field name="NUM">12</field>
                </block>
              </value>
              <statement name="DO0">
                <block type="gdl_3d_rotz" id="@82QgV-hjJ{B+LIa[ls(">
                  <value name="Z">
                    <block type="math_arithmetic" id="$$eDSq!X`#C6F!Nr(oJU">
                      <field name="OP">MULTIPLY</field>
                      <value name="A">
                        <block type="math_arithmetic" id="?c@XMn/1haM]1xoy33!Z">
                          <field name="OP">DIVIDE</field>
                          <value name="A">
                            <block type="math_number" id="!$a!(Mg+xX3+R%@guD[F">
                              <field name="NUM">360</field>
                            </block>
                          </value>
                          <value name="B">
                            <block type="math_number" id="HN!yB^b+2{B*9{l%j|E.">
                              <field name="NUM">12</field>
                            </block>
                          </value>
                        </block>
                      </value>
                      <value name="B">
                        <block type="gdl_get_variable" id="`,VtQhdti8GhhsLA@KtX">
                          <field name="VAR" id="Xoj/HzC)n(Ai.!01Ni.+" variabletype="">seat</field>
                        </block>
                      </value>
                    </block>
                  </value>
                  <statement name="DO0">
                    <block type="gdl_3d_addx" id="DlQ31kUf_7V4!84BkN9e">
                      <value name="X">
                        <block type="math_number" id="hx.lsoxC$%PP;/(^ycZD">
                          <field name="NUM">2</field>
                        </block>
                      </value>
                      <statement name="DO0">
                        <block type="gdl_3d_cylind" id="DJVALIqLDqV.Zw0RSXg3">
                          <value name="H">
                            <block type="math_number" id="YCCh{#h*%0t5^93,C`^+">
                              <field name="NUM">0.1</field>
                            </block>
                          </value>
                          <value name="R">
                            <block type="math_number" id="1_[j={7Wx==:1,vpz0iQ">
                              <field name="NUM">0.3</field>
                            </block>
                          </value>
                        </block>
                      </statement>
                    </block>
                  </statement>
                </block>
              </statement>
            </block>
          </next>
        </block>
      </next>
    </block>
  </xml>

  <script>
    var demoWorkspace = Blockly.inject('blocklyDiv',
      { 
        toolbox: document.getElementById('toolbox'),
        horizontalLayout: 'true' 
      });
    Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'), demoWorkspace);

    function showCode() {
      // Generate JavaScript code and display it.
      Blockly.GDL.INFINITE_LOOP_TRAP = null;
      var code = Blockly.GDL.workspaceToCode(demoWorkspace);
      alert(code);
    }

    function showXML() {
      var xml = Blockly.Xml.workspaceToDom (demoWorkspace);
      alert(xml.outerHTML);
    }

    function runCode() {
      // Generate JavaScript code and run it.
      window.LoopTrap = 1000;
      Blockly.GDL.INFINITE_LOOP_TRAP =
        'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
      var code = Blockly.GDL.workspaceToCode(demoWorkspace);
      Blockly.GDL.INFINITE_LOOP_TRAP = null;
      try {
        eval(code);
      } catch (e) {
        alert(e);
      }
    }
  </script>

</body>

</html>